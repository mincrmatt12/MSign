# ESP8266

## Pinouts

Debug tx is mapped to `GPIO2`.

TX/RX are on `GPIO13`/`GPIO15`.

SD is wired

| PIN | Mapped |
| --- | ------ |
| `MISO` | `GPIO12` |
| `MOSI` | `GPIO4` |
| `SCK` | `GPIO14` |
| `CS`  | `GPIO5` |

(configurable via menuconfig)

## SD Card

The SD card contains the following files:

```
|
+- config.txt
+- ca
| |
| -- <sha512 dn hash>
| -- <sha512 dn hash>
+-?model.bin
+-?model1.bin
+- web
| |
| +- page.html
| +- page.js
| +- page.css
| +-?page.html.gz
| +-?page.js.gz
| +-?page.css.gz
| +-?etag
--!upd
  |
  +- state
  +- esp.bin
  +- stm.bin
  +- webui.ar
```

Files marked with a `?` are optional, and will either be generated by the system or are not required.

Files marked with a `!` are only present during an update.

### Simple files

- `config.txt` contains the configuration in a simple `key=value` format, comments marked by a leading `#`. The list of keys can be found in `src/config.cpp`.
- `model.bin` and `model1.bin` are optional 3D models, the default is a baked in M^2 text. The format is simply a 32bit integer of the number of triangles followed by tightly packed floats for each triangle (`xyz*3, rgb`)

### Web files

The `html` file is served whenever a request is made that _doesn't_ contain a valid API URI.
The other files are served whenever a request for their exact names is made.

The compressed forms of the website files are also cached to internal flash for faster loading.
The `etag` file is generated automatically to help with caching.

### Update files

The files in the `upd` folder relate to the ongoing system update.
The `bin` files contain the entire firmware image for the two systems, stored as flat binary files.

State is a single byte indicating the update state.

## TLS files

All the files in the `ca` directory are trusted certificates. The filename is the
subject DN encoded in X.500 form and hashed with SHA512 (stored as hex) and is just
the DER-encoded X.509 certificate.
